<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>ç”¨ NodeJS æ‰“é€ å½±é™¢å¾®æœåŠ¡å¹¶éƒ¨ç½²åˆ° docker ä¸Š â€” Part 1 | Z - Computer &amp; Programming Technology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æœ¬æ–‡æ˜¯ã€Œä½¿ç”¨ NodeJS æ„å»ºå½±é™¢å¾®æœåŠ¡ã€ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚æ­¤ç³»åˆ—å°†ä¼šè®²è¿°äº†å¦‚ä½•æ„å»ºNodeJS å¾®æœåŠ¡å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ°Docker Swarm é›†ç¾¤ä¸Šã€‚
æœ¬æ–‡å°†å‘ä½ å±•ç¤ºï¼Œå¦‚ä½•æ„å»ºå¾®æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸­ã€‚æˆ‘ä»¬ä¼šå®Œæˆä¸€ä¸ªç®€å•çš„ NodeJS æœåŠ¡ï¼Œå¹¶ä»¥ MongoDB ä½œä¸ºåç«¯å­˜å‚¨ã€‚
æœ¬æ–‡å°†ä½¿ç”¨åˆ°ä»¥ä¸‹æŠ€æœ¯ï¼š

NodeJS 7.2.0 ç‰ˆæœ¬
MongoDB 3.4.1
Docke">
<meta property="og:type" content="article">
<meta property="og:title" content="ç”¨ NodeJS æ‰“é€ å½±é™¢å¾®æœåŠ¡å¹¶éƒ¨ç½²åˆ° docker ä¸Š â€” Part 1">
<meta property="og:url" content="http://log.zvz.im/2017/05/24/nodejs-cinema-microservice-part1/index.html">
<meta property="og:site_name" content="Z - Computer & Programming Technology">
<meta property="og:description" content="æœ¬æ–‡æ˜¯ã€Œä½¿ç”¨ NodeJS æ„å»ºå½±é™¢å¾®æœåŠ¡ã€ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚æ­¤ç³»åˆ—å°†ä¼šè®²è¿°äº†å¦‚ä½•æ„å»ºNodeJS å¾®æœåŠ¡å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ°Docker Swarm é›†ç¾¤ä¸Šã€‚
æœ¬æ–‡å°†å‘ä½ å±•ç¤ºï¼Œå¦‚ä½•æ„å»ºå¾®æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸­ã€‚æˆ‘ä»¬ä¼šå®Œæˆä¸€ä¸ªç®€å•çš„ NodeJS æœåŠ¡ï¼Œå¹¶ä»¥ MongoDB ä½œä¸ºåç«¯å­˜å‚¨ã€‚
æœ¬æ–‡å°†ä½¿ç”¨åˆ°ä»¥ä¸‹æŠ€æœ¯ï¼š

NodeJS 7.2.0 ç‰ˆæœ¬
MongoDB 3.4.1
Docke">
<meta property="og:image" content="https://img.zvz.im/imgs/2019/06/1212f2b3d00c4c80.png">
<meta property="og:image" content="https://img.zvz.im/imgs/2019/06/3a80c5deba7da702.png">
<meta property="og:image" content="https://img.zvz.im/imgs/2019/06/f142eea98b22201f.png">
<meta property="og:image" content="https://img.zvz.im/imgs/2019/06/f142eea98b22201f.png">
<meta property="og:updated_time" content="2024-05-12T13:15:10.157Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç”¨ NodeJS æ‰“é€ å½±é™¢å¾®æœåŠ¡å¹¶éƒ¨ç½²åˆ° docker ä¸Š â€” Part 1">
<meta name="twitter:description" content="æœ¬æ–‡æ˜¯ã€Œä½¿ç”¨ NodeJS æ„å»ºå½±é™¢å¾®æœåŠ¡ã€ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚æ­¤ç³»åˆ—å°†ä¼šè®²è¿°äº†å¦‚ä½•æ„å»ºNodeJS å¾®æœåŠ¡å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ°Docker Swarm é›†ç¾¤ä¸Šã€‚
æœ¬æ–‡å°†å‘ä½ å±•ç¤ºï¼Œå¦‚ä½•æ„å»ºå¾®æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸­ã€‚æˆ‘ä»¬ä¼šå®Œæˆä¸€ä¸ªç®€å•çš„ NodeJS æœåŠ¡ï¼Œå¹¶ä»¥ MongoDB ä½œä¸ºåç«¯å­˜å‚¨ã€‚
æœ¬æ–‡å°†ä½¿ç”¨åˆ°ä»¥ä¸‹æŠ€æœ¯ï¼š

NodeJS 7.2.0 ç‰ˆæœ¬
MongoDB 3.4.1
Docke">
<meta name="twitter:image" content="https://img.zvz.im/imgs/2019/06/1212f2b3d00c4c80.png">
  
    <link rel="alternative" href="/atom.xml" title="Z - Computer &amp; Programming Technology" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.geekzu.org/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8NRBEZPWYN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8NRBEZPWYN');
</script>


  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8768699638326268",
      enable_page_level_ads: true
    });
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main"><article id="post-nodejs-cinema-microservice-part1" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ç”¨ NodeJS æ‰“é€ å½±é™¢å¾®æœåŠ¡å¹¶éƒ¨ç½²åˆ° docker ä¸Š â€” Part 1
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/05/24/nodejs-cinema-microservice-part1/" class="article-date">
  <time datetime="2017-05-24T21:58:41.000Z" itemprop="datePublished">2017-05-24</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/tags/Nodejs/">Nodejs</a>
  </div>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img.zvz.im/imgs/2019/06/1212f2b3d00c4c80.png" alt=""></p>
<p>æœ¬æ–‡æ˜¯ã€Œä½¿ç”¨ NodeJS æ„å»ºå½±é™¢å¾®æœåŠ¡ã€ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚æ­¤ç³»åˆ—å°†ä¼šè®²è¿°äº†å¦‚ä½•æ„å»º<strong>NodeJS å¾®æœåŠ¡</strong>å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ°<strong>Docker Swarm é›†ç¾¤</strong>ä¸Šã€‚</p>
<p>æœ¬æ–‡å°†å‘ä½ å±•ç¤ºï¼Œå¦‚ä½•æ„å»º<strong>å¾®æœåŠ¡</strong>ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åˆ°<strong>Docker</strong>å®¹å™¨ä¸­ã€‚æˆ‘ä»¬ä¼šå®Œæˆä¸€ä¸ªç®€å•çš„ NodeJS æœåŠ¡ï¼Œå¹¶ä»¥ MongoDB ä½œä¸ºåç«¯å­˜å‚¨ã€‚</p>
<p>æœ¬æ–‡å°†ä½¿ç”¨åˆ°ä»¥ä¸‹æŠ€æœ¯ï¼š</p>
<ul>
<li>NodeJS 7.2.0 ç‰ˆæœ¬</li>
<li>MongoDB 3.4.1</li>
<li>Docker for Mac 1.12.6</li>
</ul>
<p>ä¸ºäº†ç†è§£æ–‡ä¸­å†…å®¹ï¼Œä½ æœ€å¥½äº†è§£ä»¥ä¸‹çŸ¥è¯†ï¼š</p>
<ul>
<li>NodeJS çš„åŸºç¡€çŸ¥è¯†</li>
<li>Docker çš„åŸºç¡€çŸ¥è¯†ï¼ˆå¹¶ä¸”å·²å®‰è£…äº† dockerï¼‰</li>
<li>MongoDB çš„åŸºç¡€çŸ¥è¯†ï¼ˆå¹¶ä¸”æœ‰å¯è¿è¡Œçš„æ•°æ®åº“æœåŠ¡ï¼‰</li>
</ul>
<p>æˆ‘å¼ºçƒˆå»ºè®®å¤§å®¶å‚è€ƒæˆ‘ä»¥å‰çš„æ–‡ç« <a href="https://medium.com/@cramirez92/how-to-deploy-a-mongodb-replica-set-using-docker-6d0b9ac00e49" target="_blank" rel="external">ã€Œå¦‚ä½•åœ¨ Docker ä¸Šéƒ¨ç½² mongoDB é›†ç¾¤ã€</a>ï¼Œéƒ¨ç½²å¥½æ•°æ®åº“æœåŠ¡å¹¶å°†å…¶è¿è¡Œèµ·æ¥ã€‚<br><a id="more"></a></p>
<h2 id="ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"><a href="#ä»€ä¹ˆæ˜¯å¾®æœåŠ¡" class="headerlink" title="# ä»€ä¹ˆæ˜¯å¾®æœåŠ¡"></a># ä»€ä¹ˆæ˜¯å¾®æœåŠ¡</h2><blockquote>
<p>å¾®æœåŠ¡æ˜¯ä¸€ä¸ªç‹¬ç«‹å¯ç”¨çš„å•å…ƒï¼Œå®ƒå¯ä»¥ä¸å…¶å®ƒå¾®æœåŠ¡ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªå¤§çš„åº”ç”¨ç³»ç»Ÿã€‚é€šè¿‡å°†ä¸€ä¸ªåº”ç”¨åˆ’åˆ†ä¸ºæ›´å°çš„å•å…ƒï¼Œå¯ä½¿å¾—è¿™äº›å°çš„å•å…ƒæ›´åŠ ç‹¬ç«‹ã€æ˜“äºéƒ¨ç½²ã€ä¸”æ˜“äºæ‰©å±•ï¼Œè€Œä¸”è¿™äº›å°å•å…ƒå¯ä»¥ç”±ä¸åŒå›¢é˜Ÿçš„å¼€å‘ï¼Œä½¿ç”¨ä¸åŒè¯­è¨€è¿›è¡Œå¼€å‘ï¼Œå¹¶ä¸”å•ç‹¬è¿›è¡Œæµ‹è¯•ã€‚â€”â€” <a href="https://medium.com/@cramirez92/how-to-deploy-a-mongodb-replica-set-using-docker-6d0b9ac00e49" target="_blank" rel="external">Max Stoiber</a></p>
<p>å¾®æœåŠ¡æ¶æ„æ„å‘³ç€ä½ çš„ç³»ç»Ÿç”±è®¸å¤šå°çš„ã€ç‹¬ç«‹çš„åº”ç”¨ç»„æˆã€‚å®ƒä»¬è¿è¡Œåœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´ä¸­ï¼Œè€Œä¸”ç‹¬ç«‹éƒ¨ç½²ï¼Œèƒ½å¤Ÿæ‰©å±•éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šã€‚â€”â€” <a href="https://medium.com/javascript-scene/10-interview-questions-every-javascript-developer-should-know-6fa6bdf5ad95#.gl46xectt" target="_blank" rel="external">Eric Elliot</a></p>
</blockquote>
<h3 id="å¾®æœåŠ¡çš„ä¼˜ç‚¹"><a href="#å¾®æœåŠ¡çš„ä¼˜ç‚¹" class="headerlink" title="å¾®æœåŠ¡çš„ä¼˜ç‚¹"></a>å¾®æœåŠ¡çš„ä¼˜ç‚¹</h3><ul>
<li>åº”ç”¨å¯åŠ¨æ›´å¿«ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œéƒ¨ç½²ä¹Ÿæ›´åŠ å¿«é€Ÿã€‚</li>
<li>æ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹äºå…¶å®ƒæœåŠ¡è¿›è¡Œéƒ¨ç½²â€”â€”è¿™æ ·æ›´å®¹æ˜“éƒ¨ç½²æ–°ç‰ˆæœ¬</li>
<li>æ›´å®¹æ˜“ç»„ç»‡å¤§è§„æ¨¡å¼€å‘ï¼Œè€Œä¸”æœ‰æ€§èƒ½ä¼˜åŠ¿ã€‚</li>
<li>å¯ä»¥é¿å…ä¸æŠ€æœ¯æ ˆé•¿æœŸæ†ç»‘ã€‚å½“å¼€å‘æ–°æœåŠ¡æ—¶ï¼Œä½ å¯ä»¥é€‰ç”¨æ–°çš„æŠ€æœ¯æ ˆã€‚</li>
<li>å¾®æœåŠ¡ä¸€èˆ¬éƒ½æœ‰æ›´å¥½çš„ç»„ç»‡ç»“æ„ï¼Œå› ä¸ºæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰ç‰¹å®šçš„ä½¿å‘½ï¼Œä¸”ä¸å…¶å®ƒæœåŠ¡æ— å…³ã€‚</li>
<li>æ— è€¦åˆçš„æœåŠ¡æ›´å®¹æ˜“é‡æ–°ç»„åˆé…ç½®ï¼Œå¯ä»¥æœåŠ¡äºä¸åŒçš„åº”ç”¨ç³»ç»Ÿï¼ˆæ¯”å¦‚ï¼ŒåŒæ—¶æœåŠ¡äº web å®¢æˆ·ç«¯ä»¥åŠå…¬å…± APIï¼‰ã€‚</li>
</ul>
<h3 id="å¾®æœåŠ¡çš„ç¼ºç‚¹"><a href="#å¾®æœåŠ¡çš„ç¼ºç‚¹" class="headerlink" title="å¾®æœåŠ¡çš„ç¼ºç‚¹"></a>å¾®æœåŠ¡çš„ç¼ºç‚¹</h3><ul>
<li>å¼€å‘è€…å¿…é¡»å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥çš„é¢å¤–å¤æ‚æ€§ã€‚</li>
<li>éƒ¨ç½²æ›´åŠ å¤æ‚ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéƒ¨ç½²å¹¶ç®¡ç†ä¸€ä¸ªç”±è®¸å¤šä¸åŒæœåŠ¡ç»„æˆçš„ç³»ç»Ÿï¼Œæ“ä½œèµ·æ¥æ›´å¤æ‚ã€‚</li>
<li>åœ¨ä½ æ„å»ºå¾®æœåŠ¡æ¶æ„çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç°è®¸å¤šåœ¨è®¾è®¡åˆæœŸæœªèƒ½é¢„æ–™åˆ°çš„åŠŸèƒ½ç‚¹è¢«åˆ‡å‰²åˆ†æ•£åˆ°äº†å„å¤„ã€‚</li>
</ul>
<h2 id="å¦‚ä½•ç”¨-NodeJS-æ„å»ºå¾®æœåŠ¡"><a href="#å¦‚ä½•ç”¨-NodeJS-æ„å»ºå¾®æœåŠ¡" class="headerlink" title="# å¦‚ä½•ç”¨ NodeJS æ„å»ºå¾®æœåŠ¡"></a># å¦‚ä½•ç”¨ NodeJS æ„å»ºå¾®æœåŠ¡</h2><p><strong>å¾®æœåŠ¡</strong>å¯ä»¥åˆ©ç”¨è®¸å¤š<strong>ç®€å•ï¼Œç›®çš„å•ä¸€ï¼Œæ˜“äºä½¿ç”¨çš„</strong>ç»„ä»¶æ„å»ºåº”ç”¨ï¼Œä½¿å¾—è½¯ä»¶è´¨é‡æ›´å¥½ï¼Œè¿­ä»£é€Ÿåº¦æ›´å¿«ã€‚ç”šè‡³å·²æœ‰çš„æ•´ä½“æ¶æ„ç³»ç»Ÿä¹Ÿå¯ä»¥é‡‡ç”¨<a href="https://blog.risingstack.com/why-you-should-start-using-microservices/" target="_blank" rel="external">å¾®æœåŠ¡æ¨¡å¼</a>è¿›è¡Œè½¬æ¢ï¼Œä¸è¿‡æˆ‘ä»¬çš„é—®é¢˜æ˜¯å¦‚ä½•ç”¨ <strong>NodeJS</strong> æ¥æ„å»ºä¸€ä¸ªå¾®æœåŠ¡ï¼Ÿ</p>
<p>Javascript æ˜¯å½“å‰æœ€æµè¡Œç¼–ç¨‹è¯­è¨€ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„å¼€æºæ¨¡å—ç”Ÿæ€ç³»ç»Ÿã€‚ å¯¹äºä¸€ä¸ªå¾®æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³è¦æ„å»ºä¸€å¥— <strong>API</strong>ï¼Œæˆ‘åº”è¯¥ç”¨å“ªäº›æ¨¡å—ï¼Œåº“ï¼Œæˆ–è€…æ¡†æ¶å‘¢ï¼Ÿæˆ‘åœ¨ Quora ä¸Šæœç´¢åˆ°äº†ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼š<a href="https://www.quora.com/Which-Node-js-framework-is-better-for-building-a-RESTful-api" target="_blank" rel="external">æ„å»º RESTful api åº”è¯¥ä½¿ç”¨å“ªä¸ª Node.js æ¡†æ¶ï¼Ÿ</a></p>
<p>é—®é¢˜çš„ç­”æ¡ˆä¸­æœ‰ä¸€ä½ç”¨æˆ·ç»™å‡ºäº†ä¸€æ¡éå¸¸æœ‰ç”¨çš„ç­”æ¡ˆï¼Œä»–æä¾›äº†ä¸€ä¸ª NB çš„<a href="http://nodeframework.com/" target="_blank" rel="external">ç½‘ç«™</a>ï¼Œé‡Œé¢å±•ç¤ºäº†æˆ‘ä»¬å¯ä»¥ç”¨æ¥æ„å»º API çš„æ‰€æœ‰æ¡†æ¶å’Œåº“ï¼Œè¿™æ ·ä½ å°±å¯ä»¥è‡ªå·±åšé€‰æ‹©äº†ã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ <strong>ExpressJS</strong> æ¥æ„å»ºæˆ‘ä»¬çš„ API å’Œå¾®æœåŠ¡ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ä¸å†ç©ºè°ˆï¼Œå¼€å§‹åŠ¨æ‰‹ç¼–ç ï¼Œå­¦ä¹ å¦‚ä½•è§£å†³è¿™ä¸ªå®é™…é—®é¢˜å§ ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ¼â€ğŸ¨ğŸ–¥ã€‚</p>
<h2 id="æˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„"><a href="#æˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„" class="headerlink" title="# æˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„"></a># æˆ‘ä»¬çš„å¾®æœåŠ¡æ¶æ„</h2><p><img src="https://img.zvz.im/imgs/2019/06/3a80c5deba7da702.png" alt=""></p>
<p>å‡è®¾æˆ‘ä»¬åœ¨ <strong>CinÃ©polis</strong>ï¼ˆä¸€ä¸ªå¢¨è¥¿å“¥ç”µå½±é™¢ï¼‰çš„ IT éƒ¨é—¨å·¥ä½œã€‚ä»–ä»¬æ´¾ç»™æˆ‘ä»¬ä¸€ä¸ªä»»åŠ¡ï¼Œè®©æˆ‘ä»¬é‡æ„ç¥¨åŠ¡å’Œé›¶å”®åº—ç³»ç»Ÿï¼Œå°†åŸæœ‰çš„ä¸€ä½“åŒ–ç³»ç»Ÿæ”¹ä¸ºå¾®æœåŠ¡æ¶æ„ã€‚</p>
<p>ä½œä¸ºã€Œä½¿ç”¨ NodeJS æ„å»ºå½±é™¢å¾®æœåŠ¡ã€ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å…³æ³¨ç‚¹æ”¾åœ¨<strong>ç”µå½±ç›®å½•æœåŠ¡(movies catalog service)</strong>ä¸Šã€‚</p>
<p>åœ¨æ¶æ„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ç§ä¸åŒçš„è®¾å¤‡ä½¿ç”¨åˆ°å¾®æœåŠ¡ã€‚POSï¼ˆå”®å–ç‚¹ï¼‰ï¼Œæ‰‹æœº/å¹³æ¿ï¼Œä»¥åŠç”µè„‘ã€‚POS å’Œæ‰‹æœº/å¹³æ¿æœ‰å•ç‹¬çš„åº”ç”¨ï¼ˆç”¨ electron å¼€å‘ï¼‰ï¼Œå¹¶ä¸”ç›´æ¥è®¿é—®å¾®æœåŠ¡ã€‚è€Œç”µè„‘ç«¯åˆ™é€šè¿‡ç½‘é¡µåº”ç”¨è®¿é—®å¾®æœåŠ¡ã€‚</p>
<h2 id="æ„å»ºå¾®æœåŠ¡"><a href="#æ„å»ºå¾®æœåŠ¡" class="headerlink" title="# æ„å»ºå¾®æœåŠ¡"></a># æ„å»ºå¾®æœåŠ¡</h2><p>ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³åœ¨è‡ªå·±å–œæ¬¢çš„ç”µå½±é™¢ä¸­å»çœ‹æŸç”µå½±çš„é¦–æ˜ ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ­¤å½±é™¢ä¸­å½“å‰æœ‰å“ªäº›ç”µå½±ä¸Šæ˜ ã€‚ä¸‹é¢è¿™ç§å›¾å±•ç¤ºäº†å¾®æœåŠ¡ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ REST æ–¹å¼è¿›è¡Œä¿¡æ¯äº¤æµçš„ã€‚</p>
<p><img src="https://img.zvz.im/imgs/2019/06/f142eea98b22201f.png" alt=""></p>
<p>æˆ‘ä»¬çš„<strong>ç”µå½±æœåŠ¡ï¼ˆmovies serviceï¼‰</strong> API è§„æ ¼å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">#%RAML 1.0</div><div class="line">title: cinema</div><div class="line">version: v1</div><div class="line">baseUri: /</div><div class="line"></div><div class="line">types:</div><div class="line">  Movie:</div><div class="line">    properties:</div><div class="line">      id: string</div><div class="line">      title: string</div><div class="line">      runtime: number</div><div class="line">      format: string</div><div class="line">      plot: string</div><div class="line">      releaseYear: number</div><div class="line">      releaseMonth: number</div><div class="line">      releaseDay: number</div><div class="line">    example:</div><div class="line">      id: &quot;123&quot;</div><div class="line">      title: &quot;Assasins Creed&quot;</div><div class="line">      runtime: 115</div><div class="line">      format: &quot;IMAX&quot;</div><div class="line">      plot: &quot;Lorem ipsum dolor sit amet&quot;</div><div class="line">      releaseYear : 2017</div><div class="line">      releaseMonth: 1</div><div class="line">      releaseDay: 6</div><div class="line"></div><div class="line">  MoviePremieres:</div><div class="line">    type: Movie []</div><div class="line"></div><div class="line"></div><div class="line">resourceTypes:</div><div class="line">  Collection:</div><div class="line">    get:</div><div class="line">      responses:</div><div class="line">        200:</div><div class="line">          body:</div><div class="line">            application/json:</div><div class="line">              type: &lt;&lt;item&gt;&gt;</div><div class="line"></div><div class="line">/movies:</div><div class="line">  /premieres:</div><div class="line">    type:  &#123; Collection: &#123;item : MoviePremieres &#125; &#125;</div><div class="line"></div><div class="line">  /&#123;id&#125;:</div><div class="line">    type:  &#123; Collection: &#123;item : Movie &#125; &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p> å¦‚æœä½ ä¸çŸ¥é“ <strong>RAML</strong> æ˜¯ä»€ä¹ˆï¼Œè¿™å„¿æœ‰ä¸€ç¯‡å¾ˆå¥½çš„<a href="http://apiworkbench.com/docs/" target="_blank" rel="external">å…¥é—¨ä»‹ç»</a>ã€‚</p>
</blockquote>
<p>æ­¤ API é¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">-</span> <span class="string">api/</span>                  <span class="comment"># our apis</span></div><div class="line"><span class="bullet">-</span> <span class="string">config/</span>               <span class="comment"># config for the app</span></div><div class="line"><span class="bullet">-</span> <span class="string">mock/</span>                 <span class="comment"># not necessary just for data examples</span></div><div class="line"><span class="bullet">-</span> <span class="string">repository/</span>           <span class="comment"># abstraction over our db</span></div><div class="line"><span class="bullet">-</span> <span class="string">server/</span>               <span class="comment"># server setup code</span></div><div class="line"><span class="bullet">-</span> <span class="string">package.json</span>          <span class="comment"># dependencies</span></div><div class="line"><span class="bullet">-</span> <span class="string">index.js</span>              <span class="comment"># main entrypoint of the app</span></div></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬å¼€å§‹ç¼–ç ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ª <code>repository</code> ã€‚è¿™æ˜¯æˆ‘ä»¬è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢çš„åœ°æ–¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// repository.js</span></div><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="comment">// factory function, that holds an open connection to the db,</span></div><div class="line"><span class="comment">// and exposes some functions for accessing the data.</span></div><div class="line"><span class="keyword">const</span> repository = <span class="function">(<span class="params">db</span>) =&gt;</span> &#123;</div><div class="line">  </div><div class="line">  <span class="comment">// since this is the movies-service, we already know</span></div><div class="line">  <span class="comment">// that we are going to query the `movies` collection</span></div><div class="line">  <span class="comment">// in all of our functions.</span></div><div class="line">  <span class="keyword">const</span> collection = db.collection(<span class="string">'movies'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">const</span> getMoviePremiers = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> movies = []</div><div class="line">      <span class="keyword">const</span> currentDay = <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">      <span class="keyword">const</span> query = &#123;</div><div class="line">        <span class="attr">releaseYear</span>: &#123;</div><div class="line">          <span class="attr">$gt</span>: currentDay.getFullYear() - <span class="number">1</span>,</div><div class="line">          <span class="attr">$lte</span>: currentDay.getFullYear()</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">releaseMonth</span>: &#123;</div><div class="line">          <span class="attr">$gte</span>: currentDay.getMonth() + <span class="number">1</span>,</div><div class="line">          <span class="attr">$lte</span>: currentDay.getMonth() + <span class="number">2</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">releaseDay</span>: &#123;</div><div class="line">          <span class="attr">$lte</span>: currentDay.getDate()</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">const</span> cursor = collection.find(query)</div><div class="line">      <span class="keyword">const</span> addMovie = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</div><div class="line">        movies.push(movie)</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">const</span> sendMovies = <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">          reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'An error occured fetching all movies, err:'</span> + err))</div><div class="line">        &#125;</div><div class="line">        resolve(movies)</div><div class="line">      &#125;</div><div class="line">      cursor.forEach(addMovie, sendMovies)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> getMovieById = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> projection = &#123; <span class="attr">_id</span>: <span class="number">0</span>, <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="number">1</span>, <span class="attr">format</span>: <span class="number">1</span> &#125;</div><div class="line">      <span class="keyword">const</span> sendMovie = <span class="function">(<span class="params">err, movie</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">          reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`An error occured fetching a movie with id: <span class="subst">$&#123;id&#125;</span>, err: <span class="subst">$&#123;err&#125;</span>`</span>))</div><div class="line">        &#125;</div><div class="line">        resolve(movie)</div><div class="line">      &#125;</div><div class="line">      <span class="comment">// fetch a movie by id -- mongodb syntax</span></div><div class="line">      collection.findOne(&#123;<span class="attr">id</span>: id&#125;, projection, sendMovie)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// this will close the database connection</span></div><div class="line">  <span class="keyword">const</span> disconnect = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    db.close()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.create(&#123;</div><div class="line">    getAllMovies,</div><div class="line">    getMoviePremiers,</div><div class="line">    getMovieById,</div><div class="line">    disconnect</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> connect = <span class="function">(<span class="params">connection</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span> (!connection) &#123;</div><div class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'connection db not supplied!'</span>))</div><div class="line">    &#125;</div><div class="line">    resolve(repository(connection))</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"><span class="comment">// this only exports a connected repo</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;connect&#125;)</div><div class="line"></div><div class="line"><span class="comment">// movie-service-repo.js</span></div></pre></td></tr></table></figure>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬å‘å”¯ä¸€æš´éœ²çš„ <strong>connect</strong>(connection) æ–¹æ³•ä¼ å…¥äº†ä¸€ä¸ª <code>connection</code> å¯¹è±¡ï¼Œè¿™å„¿ä½ å¯ä»¥çœ‹åˆ° javascript æœ€å¼ºå¤§ä¹‹å¤„çš„<strong>â€œé—­åŒ…â€</strong>ï¼Œè¿™ä¸ªä»“åº“å¯¹è±¡è¿”å›äº†ä¸€ä¸ªé—­åŒ…ï¼Œå…¶ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½èƒ½è®¿é—®åˆ° <code>db</code> å’Œ <code>collection</code> å¯¹è±¡ï¼Œ <code>db</code>  å¯¹è±¡ä¿æŒç€æ•°æ®åº“è¿æ¥ã€‚è¿™é‡Œæˆ‘ä»¬å¯¹æ‰€è¿æ¥æ•°æ®åº“çš„ç±»å‹è¿›è¡Œäº†æŠ½è±¡ï¼Œrepository å¯¹è±¡å¹¶ä¸çŸ¥é“ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§æ•°æ®åº“ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <strong>MongoDB</strong>ï¼Œå®ƒä¹Ÿä¸çŸ¥é“è¿æ¥çš„æ•°æ®åº“æ˜¯å•ä¾‹è¿˜æ˜¯é›†ç¾¤ï¼Œä¸è¿‡åªè¦æˆ‘ä»¬ä½¿ç”¨ mongodb çš„è¯­æ³•ï¼Œæˆ‘ä»¬å°±èƒ½ä½¿ç”¨ repository ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <a href="https://medium.com/@cramirez92/s-o-l-i-d-the-first-5-priciples-of-object-oriented-design-with-javascript-790f6ac9b9fa#.ubs2g1ozf" target="_blank" rel="external">solid principles</a> ä¸­çš„<em>ä¾èµ–åè½¬æ–¹å¼</em>ï¼Œå°† mongo è¯­æ³•æ‹†åˆ†åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œåªè°ƒç”¨æ•°æ®åº“æ“ä½œæ¥å£ï¼ˆæ¯”å¦‚ä½¿ç”¨ mongoose æ¨¡å‹ï¼‰ã€‚</p>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª <code>repository/repository.spec.js</code> æ–‡ä»¶ç”¨äºæµ‹è¯•è¿™ä¸ªæ¨¡å—ï¼Œä»¥åæˆ‘å°†ä¼šè®²åˆ°æµ‹è¯•çš„éƒ¨åˆ†ï¼Œä½ å¯ä»¥åœ¨ <a href="https://github.com/Crizstian/cinema-microservice" target="_blank" rel="external">github ä»“åº“çš„ step-1 åˆ†æ”¯</a>ä¸­æ‰¾åˆ°å®ƒã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>server.js</code> æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">'morgan'</span>)</div><div class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">'helmet'</span>)</div><div class="line"><span class="keyword">const</span> movieAPI = <span class="built_in">require</span>(<span class="string">'../api/movies'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> start = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// we need to verify if we have a repository added and a server port</span></div><div class="line">    <span class="keyword">if</span> (!options.repo) &#123;</div><div class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'The server must be started with a connected repository'</span>))</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!options.port) &#123;</div><div class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'The server must be started with an available port'</span>))</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// let's init a express app, and add some middlewares</span></div><div class="line">    <span class="keyword">const</span> app = express()</div><div class="line">    app.use(morgan(<span class="string">'dev'</span>))</div><div class="line">    app.use(helmet())</div><div class="line">    app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</div><div class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Something went wrong!, err:'</span> + err))</div><div class="line">      res.status(<span class="number">500</span>).send(<span class="string">'Something went wrong!'</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment">// we add our API's to the express app</span></div><div class="line">    movieAPI(app, options)</div><div class="line">    </div><div class="line">    <span class="comment">// finally we start the server, and return the newly created server </span></div><div class="line">    <span class="keyword">const</span> server = app.listen(options.port, () =&gt; resolve(server))</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;start&#125;)</div><div class="line"></div><div class="line"><span class="comment">// movie-service-server.js</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ªæ–°çš„ express åº”ç”¨ï¼ŒéªŒè¯æˆ‘ä»¬æ˜¯å¦æä¾›äº†ä»“åº“å¯¹è±¡ä»¥åŠå’ŒæœåŠ¡ç«¯å£å‚æ•°ï¼Œç„¶åä½¿ç”¨äº†ä¸€äº›ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ç”¨äºæ—¥å¿—çš„ <code>morgan</code> ï¼Œç”¨äºå®‰å…¨çš„ <code>helmet</code> ï¼Œä»¥åŠä¸€ä¸ª <code>é”™è¯¯å¤„ç†</code> å‡½æ•°ï¼Œæœ€åå¯¹å¤–æä¾›äº†ä¸€ä¸ª start æ–¹æ³•ï¼Œç”¨äºå¯åŠ¨æœåŠ¡ğŸ˜ã€‚</p>
<blockquote>
<p>Helmet åŒ…æ‹¬äº†å¤šè¾¾ 11 ä¸ªæ¨¡å—å…¨éƒ¨æ˜¯ç”¨äºé˜»æ­¢é’ˆå¯¹ç”¨æˆ·çš„æ¶æ„æ”»å‡»ã€‚</p>
</blockquote>
<p>å¦‚æœä½ æƒ³åŠ å¼ºä½ çš„å¾®æœåŠ¡çš„å®‰å…¨æ€§ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://nodesource.com/blog/nine-security-tips-to-keep-express-from-getting-pwned/?utm_source=nodeweekly&amp;utm_medium=email" target="_blank" rel="external">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬çš„ server è¦ä½¿ç”¨åˆ° movieAPIï¼Œé‚£å°±è®©æˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹ <code>movies.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">const</span> status = <span class="built_in">require</span>(<span class="string">'http-status'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">app, options</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> &#123;repo&#125; = options</div><div class="line">  </div><div class="line">  <span class="comment">// here we get all the movies </span></div><div class="line">  app.get(<span class="string">'/movies'</span>, (req, res, next) =&gt; &#123;</div><div class="line">    repo.getAllMovies().then(<span class="function"><span class="params">movies</span> =&gt;</span> &#123;</div><div class="line">      res.status(status.OK).json(movies)</div><div class="line">    &#125;).catch(next)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="comment">// here we retrieve only the premieres</span></div><div class="line">  app.get(<span class="string">'/movies/premieres'</span>, (req, res, next) =&gt; &#123;</div><div class="line">    repo.getMoviePremiers().then(<span class="function"><span class="params">movies</span> =&gt;</span> &#123;</div><div class="line">      res.status(status.OK).json(movies)</div><div class="line">    &#125;).catch(next)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="comment">// here we get a movie by id</span></div><div class="line">  app.get(<span class="string">'/movies/:id'</span>, (req, res, next) =&gt; &#123;</div><div class="line">    repo.getMovieById(req.params.id).then(<span class="function"><span class="params">movie</span> =&gt;</span> &#123;</div><div class="line">      res.status(status.OK).json(movie)</div><div class="line">    &#125;).catch(next)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// movies-service-movies.js</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ä¸º API å®šä¹‰äº†è·¯ç”±ï¼Œå¹¶æ ¹æ®è·¯ç”±è°ƒç”¨ä»“åº“å¯¹è±¡çš„ä¸åŒæ–¹æ³•ã€‚ä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™é‡Œæ˜¯ç›´æ¥è°ƒç”¨ä»“åº“å¯¹è±¡çš„æ¥å£çš„ï¼Œæˆ‘ä»¬åœ¨å®è·µç€è‘—åçš„ã€Œé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°ç¼–ç¨‹ã€ç®´è¨€ï¼ˆcoding for an interface not to an implementationï¼‰ï¼Œå› ä¸º express è·¯ç”±å¹¶ä¸çŸ¥é“æ•°æ®åº“å¯¹è±¡çš„å­˜åœ¨ï¼Œä¹Ÿä¸çŸ¥é“æ•°æ®åº“æŸ¥è¯¢çš„é€»è¾‘ç­‰ç­‰ï¼Œå®ƒåªæ˜¯è°ƒç”¨äº†ä»“åº“å¯¹è±¡çš„æ–¹æ³•ç”¨äºå¤„ç†æ‰€æœ‰çš„æ•°æ®åº“ç›¸å…³ä¸šåŠ¡ã€‚</p>
<p>æˆ‘ä»¬æ‰€æœ‰çš„ä»£ç éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>movies.js</code> çš„æµ‹è¯•ä»£ç ã€‚</p>
<blockquote>
<p>ä½ å¯ä»¥å°†æµ‹è¯•ä»£ç å½“ä½œä½ æ‰€æ„å»ºåº”ç”¨çš„ä¿æŠ¤æªæ–½ã€‚å®ƒä»¬ä¸ä»…åœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼Œè¿˜ä¼šåœ¨æŒç»­é›†æˆæœåŠ¡ä¸­æ‰§è¡Œï¼Œä»¥ä¿è¯å¤±è´¥çš„æ„å»ºä¸ä¼šè¢«æ¨é€åˆ°ç”Ÿæˆç¯å¢ƒä¸­ã€‚â€”â€” <a href="https://medium.com/@RisingStack" target="_blank" rel="external">Trace by RisingStack</a></p>
</blockquote>
<p>ä¸ºäº†å†™å•å…ƒæµ‹è¯•ï¼Œæ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½å¿…é¡»è¿›è¡Œä¼ªé€ ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸ºè¦æµ‹è¯•çš„æ¨¡å—æä¾›ä¼ªé€ çš„ä¾èµ–é¡¹ã€‚ç°åœ¨çœ‹ä¸‹æˆ‘ä»¬çš„ <code>æ ‡å‡†æµ‹è¯•æ–‡ä»¶</code> é•¿ä»€ä¹ˆæ ·å­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* eslint-env mocha */</span></div><div class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'supertest'</span>)</div><div class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'../server/server'</span>)</div><div class="line"></div><div class="line">describe(<span class="string">'Movies API'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> app = <span class="literal">null</span></div><div class="line">  <span class="keyword">let</span> testMovies = [&#123;</div><div class="line">    <span class="string">'id'</span>: <span class="string">'3'</span>,</div><div class="line">    <span class="string">'title'</span>: <span class="string">'xXx: Reactivado'</span>,</div><div class="line">    <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">    <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">    <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">    <span class="string">'releaseDay'</span>: <span class="number">20</span></div><div class="line">  &#125;, &#123;</div><div class="line">    <span class="string">'id'</span>: <span class="string">'4'</span>,</div><div class="line">    <span class="string">'title'</span>: <span class="string">'Resident Evil: Capitulo Final'</span>,</div><div class="line">    <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">    <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">    <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">    <span class="string">'releaseDay'</span>: <span class="number">27</span></div><div class="line">  &#125;, &#123;</div><div class="line">    <span class="string">'id'</span>: <span class="string">'1'</span>,</div><div class="line">    <span class="string">'title'</span>: <span class="string">'Assasins Creed'</span>,</div><div class="line">    <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">    <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">    <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">    <span class="string">'releaseDay'</span>: <span class="number">6</span></div><div class="line">  &#125;]</div><div class="line"></div><div class="line">  <span class="keyword">let</span> testRepo = &#123;</div><div class="line">    getAllMovies () &#123;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(testMovies)</div><div class="line">    &#125;,</div><div class="line">    getMoviePremiers () &#123;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(testMovies.filter(<span class="function"><span class="params">movie</span> =&gt;</span> movie.releaseYear === <span class="number">2017</span>))</div><div class="line">    &#125;,</div><div class="line">    getMovieById (id) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(testMovies.find(<span class="function"><span class="params">movie</span> =&gt;</span> movie.id === id))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> server.start(&#123;</div><div class="line">      <span class="attr">port</span>: <span class="number">3000</span>,</div><div class="line">      <span class="attr">repo</span>: testRepo</div><div class="line">    &#125;).then(<span class="function"><span class="params">serv</span> =&gt;</span> &#123;</div><div class="line">      app = serv</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  afterEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    app.close()</div><div class="line">    app = <span class="literal">null</span></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  it(<span class="string">'can return all movies'</span>, (done) =&gt; &#123;</div><div class="line">    request(app)</div><div class="line">      .get(<span class="string">'/movies'</span>)</div><div class="line">      .expect(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">        res.body.should.containEql(&#123;</div><div class="line">          <span class="string">'id'</span>: <span class="string">'1'</span>,</div><div class="line">          <span class="string">'title'</span>: <span class="string">'Assasins Creed'</span>,</div><div class="line">          <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">          <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">          <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">          <span class="string">'releaseDay'</span>: <span class="number">6</span></div><div class="line">        &#125;)</div><div class="line">      &#125;)</div><div class="line">      .expect(<span class="number">200</span>, done)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  it(<span class="string">'can get movie premiers'</span>, (done) =&gt; &#123;</div><div class="line">    request(app)</div><div class="line">    .get(<span class="string">'/movies/premiers'</span>)</div><div class="line">    .expect(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">      res.body.should.containEql(&#123;</div><div class="line">        <span class="string">'id'</span>: <span class="string">'1'</span>,</div><div class="line">        <span class="string">'title'</span>: <span class="string">'Assasins Creed'</span>,</div><div class="line">        <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">        <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">        <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">'releaseDay'</span>: <span class="number">6</span></div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">    .expect(<span class="number">200</span>, done)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  it(<span class="string">'returns 200 for an known movie'</span>, (done) =&gt; &#123;</div><div class="line">    request(app)</div><div class="line">      .get(<span class="string">'/movies/1'</span>)</div><div class="line">      .expect(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</div><div class="line">        res.body.should.containEql(&#123;</div><div class="line">          <span class="string">'id'</span>: <span class="string">'1'</span>,</div><div class="line">          <span class="string">'title'</span>: <span class="string">'Assasins Creed'</span>,</div><div class="line">          <span class="string">'format'</span>: <span class="string">'IMAX'</span>,</div><div class="line">          <span class="string">'releaseYear'</span>: <span class="number">2017</span>,</div><div class="line">          <span class="string">'releaseMonth'</span>: <span class="number">1</span>,</div><div class="line">          <span class="string">'releaseDay'</span>: <span class="number">6</span></div><div class="line">        &#125;)</div><div class="line">      &#125;)</div><div class="line">      .expect(<span class="number">200</span>, done)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//movie-service-movie.spec.js</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* eslint-env mocha */</span></div><div class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'./server'</span>)</div><div class="line"></div><div class="line">describe(<span class="string">'Server'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'should require a port to start'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> server.start(&#123;</div><div class="line">      <span class="attr">repo</span>: &#123;&#125;</div><div class="line">    &#125;).should.be.rejectedWith(<span class="regexp">/port/</span>)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  it(<span class="string">'should require a repository to start'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> server.start(&#123;</div><div class="line">      <span class="attr">port</span>: &#123;&#125;</div><div class="line">    &#125;).should.be.rejectedWith(<span class="regexp">/repository/</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// movie-service-server.spec.js</span></div></pre></td></tr></table></figure>
<p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬ä¼ªé€ äº† <code>movies API</code> çš„ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬éªŒè¯äº† server å¯¹è±¡éœ€è¦æœåŠ¡ç«¯å£å’Œä»“åº“å¯¹è±¡ã€‚</p>
<p>ä½ å¯åœ¨æ–‡æœ¬çš„ github ä»“åº“ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æµ‹è¯•æ–‡ä»¶ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹å¦‚ä½•åˆ›å»º<strong>ä»“åº“æ¨¡å—</strong>ä¸­çš„ <code>æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ˆdb connection objectï¼‰</code> ï¼Œåœ¨æˆ‘ä»¬çš„è§„åˆ’ä¸­æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œä½†æ˜¯åªä¼šä½¿ç”¨ä¸€ä¸ª <strong>mongoDB é›†ç¾¤æœåŠ¡</strong>ï¼Œåªæ˜¯æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šä½¿ç”¨è‡ªå·±çš„åº“ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬ä½¿ç”¨ <strong>NodeJS</strong> è¿æ¥ <strong>MongoDB</strong> çš„æ•°æ®åº“é…ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>)</div><div class="line"></div><div class="line"><span class="comment">// here we create the url connection string that the driver needs</span></div><div class="line"><span class="keyword">const</span> getMongoURL = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> url = options.servers</div><div class="line">    .reduce(<span class="function">(<span class="params">prev, cur</span>) =&gt;</span> prev + <span class="string">`<span class="subst">$&#123;cur.ip&#125;</span>:<span class="subst">$&#123;cur.port&#125;</span>,`</span>, <span class="string">'mongodb://'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;url.substr(<span class="number">0</span>, url.length - <span class="number">1</span>)&#125;</span>/<span class="subst">$&#123;options.db&#125;</span>`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// mongoDB function to connect, open and authenticate</span></div><div class="line"><span class="keyword">const</span> connect = <span class="function">(<span class="params">options, mediator</span>) =&gt;</span> &#123;</div><div class="line">  mediator.once(<span class="string">'boot.ready'</span>, () =&gt; &#123;</div><div class="line">    MongoClient.connect( getMongoURL(options), &#123;</div><div class="line">        <span class="attr">db</span>: options.dbParameters(),</div><div class="line">        <span class="attr">server</span>: options.serverParameters(),</div><div class="line">        <span class="attr">replset</span>: options.replsetParameters(options.repl)</div><div class="line">      &#125;, (err, db) =&gt; &#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">          mediator.emit(<span class="string">'db.error'</span>, err)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        db.admin().authenticate(options.user, options.pass, (err, result) =&gt; &#123;</div><div class="line">          <span class="keyword">if</span> (err) &#123;</div><div class="line">            mediator.emit(<span class="string">'db.error'</span>, err)</div><div class="line">          &#125;</div><div class="line">          mediator.emit(<span class="string">'db.ready'</span>, db)</div><div class="line">        &#125;)</div><div class="line">      &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123;connect&#125;)</div><div class="line"></div><div class="line"><span class="comment">// mongodb-relicaset.js</span></div></pre></td></tr></table></figure>
<p>è™½ç„¶å¯èƒ½è¿˜æœ‰å…¶å®ƒæ›´å¥½çš„å®ç°æ–¹å¼ï¼Œä¸è¿‡æˆ‘ä»¬åŸºæœ¬ä¸Šè¿™æ ·å°±å¯ä»¥ä¸ mongoDB é›†ç¾¤å»ºç«‹è¿æ¥äº†ã€‚</p>
<p>å¦‚ä½ ç¼©å‡ï¼Œæˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ª <code>options</code> å¯¹è±¡ï¼Œå®ƒåŒ…å«æ‰€æœ‰ mongo è¿æ¥éœ€è¦çš„å‚æ•°ï¼Œæˆ‘ä»¬è¿˜ä¼ å…¥äº†ä¸€ä¸ª <code>event - mediator</code> å¯¹è±¡ï¼Œå½“æˆ‘ä»¬é€šè¿‡æ•°æ®åº“è¿æ¥éªŒè¯æ—¶ï¼Œå®ƒä¼šå–·å‡ºä¸€ä¸ª <code>db</code> å¯¹è±¡ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„*</strong> è¿™é‡Œæˆ‘ä¹‹æ‰€ä»¥ä½¿ç”¨äº†ä¸€ä¸ª event-emitter object æ˜¯å› ä¸ºä½¿ç”¨ promise æ–¹å¼æ—¶ï¼Œå½“é€šè¿‡è¿æ¥éªŒè¯åï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› å®ƒä¸èƒ½è¿”å› db å¯¹è±¡ï¼Œæµç¨‹æ— æ³•èµ°ä¸‹å»â€”â€”æ‰€ä»¥ä½ å¯ä»¥æŒ‘æˆ˜ä¸€ä¸‹ï¼Œå°è¯•ä½¿ç”¨ promise æ–¹å¼åšä¸€ä¸ªå®ç°ï¼Œçœ‹çœ‹åˆ°åº•å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
</blockquote>
<p>æ—¢ç„¶æˆ‘ä»¬ç”¨åˆ°äº† <code>options</code> å‚æ•°ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬çœ‹ä¸‹å®ƒæ¥è‡ªå“ªé‡Œï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªæ–‡ä»¶æ˜¯ <code>config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// simple configuration file</span></div><div class="line"></div><div class="line"><span class="comment">// database parameters</span></div><div class="line"><span class="keyword">const</span> dbSettings = &#123;</div><div class="line">  <span class="attr">db</span>: process.env.DB || <span class="string">'movies'</span>,</div><div class="line">  <span class="attr">user</span>: process.env.DB_USER || <span class="string">'cristian'</span>,</div><div class="line">  <span class="attr">pass</span>: process.env.DB_PASS || <span class="string">'cristianPassword2017'</span>,</div><div class="line">  <span class="attr">repl</span>: process.env.DB_REPLS || <span class="string">'rs1'</span>,</div><div class="line">  <span class="attr">servers</span>: (process.env.DB_SERVERS) ? process.env.DB_SERVERS.split(<span class="string">' '</span>) : [</div><div class="line">    <span class="string">'192.168.99.100:27017'</span>,</div><div class="line">    <span class="string">'192.168.99.101:27017'</span>,</div><div class="line">    <span class="string">'192.168.99.102:27017'</span></div><div class="line">  ],</div><div class="line">  <span class="attr">dbParameters</span>: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</div><div class="line">    <span class="attr">w</span>: <span class="string">'majority'</span>,</div><div class="line">    <span class="attr">wtimeout</span>: <span class="number">10000</span>,</div><div class="line">    <span class="attr">j</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">readPreference</span>: <span class="string">'ReadPreference.SECONDARY_PREFERRED'</span>,</div><div class="line">    <span class="attr">native_parser</span>: <span class="literal">false</span></div><div class="line">  &#125;),</div><div class="line">  <span class="attr">serverParameters</span>: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</div><div class="line">    <span class="attr">autoReconnect</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">poolSize</span>: <span class="number">10</span>,</div><div class="line">    <span class="attr">socketoptions</span>: &#123;</div><div class="line">      <span class="attr">keepAlive</span>: <span class="number">300</span>,</div><div class="line">      <span class="attr">connectTimeoutMS</span>: <span class="number">30000</span>,</div><div class="line">      <span class="attr">socketTimeoutMS</span>: <span class="number">30000</span></div><div class="line">    &#125;</div><div class="line">  &#125;),</div><div class="line">  <span class="attr">replsetParameters</span>: <span class="function">(<span class="params">replset = <span class="string">'rs1'</span></span>) =&gt;</span> (&#123;</div><div class="line">    <span class="attr">replicaSet</span>: replset,</div><div class="line">    <span class="attr">ha</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">haInterval</span>: <span class="number">10000</span>,</div><div class="line">    <span class="attr">poolSize</span>: <span class="number">10</span>,</div><div class="line">    <span class="attr">socketoptions</span>: &#123;</div><div class="line">      <span class="attr">keepAlive</span>: <span class="number">300</span>,</div><div class="line">      <span class="attr">connectTimeoutMS</span>: <span class="number">30000</span>,</div><div class="line">      <span class="attr">socketTimeoutMS</span>: <span class="number">30000</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// server parameters</span></div><div class="line"><span class="keyword">const</span> serverSettings = &#123;</div><div class="line">  <span class="attr">port</span>: process.env.PORT || <span class="number">3000</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123; dbSettings, serverSettings &#125;)</div><div class="line"></div><div class="line"><span class="comment">// movie-service-config.js</span></div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œç»å¤§å¤šæ•°æ—¶å€™ï¼Œé…ç½®ä»£ç éƒ½æ˜¯ç¡¬ç¼–ç çš„ï¼Œä¸è¿‡ä½ å¯ä»¥çœ‹åˆ°æœ‰äº›å±æ€§ä½¿ç”¨äº†ç¯å¢ƒå˜é‡ä½œä¸ºä¸€ä¸ªå¯é€‰é¡¹ã€‚ä½¿ç”¨ç¯å¢ƒå˜é‡è¢«è®¤ä¸ºæ˜¯å®è·µèŒƒå¼ï¼Œå› ä¸ºè¿™æ ·åœ¨å¯ä»¥æ–‡ä»¶ä¸­éšè—æ•°æ®åº“è®¤è¯ä¿¡æ¯åŠæœåŠ¡å™¨å‚æ•°ç­‰ã€‚</p>
<p>æœ€ç»ˆï¼Œ<code>movies-service</code>  API çš„æœ€åä¸€æ­¥å°±æ˜¯æŠŠæ‰€æœ‰è¿™äº›æ¨¡å—é›†åˆåˆ° <code>index.js</code> ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="comment">// we load all the depencies we need</span></div><div class="line"><span class="keyword">const</span> &#123;EventEmitter&#125; = <span class="built_in">require</span>(<span class="string">'events'</span>)</div><div class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'./server/server'</span>)</div><div class="line"><span class="keyword">const</span> repository = <span class="built_in">require</span>(<span class="string">'./repository/repository'</span>)</div><div class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./config/'</span>)</div><div class="line"><span class="keyword">const</span> mediator = <span class="keyword">new</span> EventEmitter()</div><div class="line"></div><div class="line"><span class="comment">// verbose logging when we are starting the server</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'--- Movies Service ---'</span>)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Connecting to movies repository...'</span>)</div><div class="line"></div><div class="line"><span class="comment">// log unhandled execpetions</span></div><div class="line">process.on(<span class="string">'uncaughtException'</span>, (err) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.error(<span class="string">'Unhandled Exception'</span>, err)</div><div class="line">&#125;)</div><div class="line">process.on(<span class="string">'uncaughtRejection'</span>, (err, promise) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.error(<span class="string">'Unhandled Rejection'</span>, err)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// event listener when the repository has been connected</span></div><div class="line">mediator.on(<span class="string">'db.ready'</span>, (db) =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> rep</div><div class="line">  repository.connect(db)</div><div class="line">    .then(<span class="function"><span class="params">repo</span> =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'Repository Connected. Starting Server'</span>)</div><div class="line">      rep = repo</div><div class="line">      <span class="keyword">return</span> server.start(&#123;</div><div class="line">        <span class="attr">port</span>: config.serverSettings.port,</div><div class="line">        repo</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function"><span class="params">app</span> =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">`Server started succesfully, running on port: <span class="subst">$&#123;config.serverSettings.port&#125;</span>.`</span>)</div><div class="line">      app.on(<span class="string">'close'</span>, () =&gt; &#123;</div><div class="line">        rep.disconnect()</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line">mediator.on(<span class="string">'db.error'</span>, (err) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.error(err)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// we load the connection to the repository</span></div><div class="line">config.db.connect(config.dbSettings, mediator)</div><div class="line"><span class="comment">// init the repository connection, and the event listener will handle the rest</span></div><div class="line">mediator.emit(<span class="string">'boot.ready'</span>)</div><div class="line"></div><div class="line"><span class="comment">// movie-service-index.js</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬é›†æˆäº†æ‰€æœ‰çš„ç”µå½± API æœåŠ¡ï¼Œå¹¶ä¸”è®¾ç½®äº†ä¸€ä¸ªç®€å•çš„é”™è¯¯å¤„ç†è¿‡ç¨‹ï¼Œä¹‹åæˆ‘ä»¬åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿æ¥æ•°æ®ä»“åº“ï¼Œæœ€ç»ˆå¯åŠ¨æœåŠ¡ã€‚</p>
<p>åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰ API å¼€å‘ç›¸å…³çš„å·¥ä½œï¼Œä½ å¯ä»¥åœ¨ä»£ç åº“çš„ <a href="https://github.com/Crizstian/cinema-microservice/tree/step-1" target="_blank" rel="external">step-1 åˆ†æ”¯</a> æ‰¾åˆ°æºç ã€‚</p>
<p>å¦‚æœä½ åˆ° github ä»“åº“å»çœ‹ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°ä»¥ä¸‹è¿™äº›å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">npm install          <span class="comment"># setup node dependencies  </span></div><div class="line">npm <span class="built_in">test</span>             <span class="comment"># unit test with mocha  </span></div><div class="line">npm start            <span class="comment"># starts the service  </span></div><div class="line">npm run node-debug   <span class="comment"># run the server in debug mode </span></div><div class="line">npm run chrome-debug <span class="comment"># debug the node with chrome</span></div><div class="line">npm run lint         <span class="comment"># lint the code with standard</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>npm start</code> å‘½ä»¤å¯åŠ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå¹¶åœ¨æœ¬åœ°è¿è¡Œï¼Œè¿™å¯ä¸æ˜¯æ–‡ç« æ ‡é¢˜æ‰€å£°ç§°çš„è¿è¡Œåœ¨ docker ä¸­ğŸ¤”ã€‚</p>
<p>ä¸è¿‡é¦–å…ˆæˆ‘ä»¬è¦åšçš„ï¼Œæ˜¯æ‹¥æœ‰ <a href="https://medium.com/@cramirez92/how-to-deploy-a-mongodb-replica-set-using-docker-6d0b9ac00e49#.xln0x0owy" target="_blank" rel="external">â€œç”¨ docker åˆ›å»ºä¸€ä¸ª mongoDB é›†ç¾¤â€</a> è¿™ç¯‡æ–‡ç« ä¸­çš„ <strong>Docker</strong> ç¯å¢ƒï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ä¸ºå¾®æœåŠ¡åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚è¿™å„¿è¿˜æœ‰äº›å‘½ä»¤æ˜¯ç”¨æ¥æµ‹è¯•æˆ‘ä»¬çš„ç”µå½±æœåŠ¡çš„ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>Dockerfile</strong> å°†æˆ‘ä»¬çš„ <strong>NodeJS å¾®æœåŠ¡</strong> Docker åŒ–ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Node v7 as the base image to support ES6</span></div><div class="line"><span class="keyword">FROM</span> node:<span class="number">7.2</span>.<span class="number">0</span></div><div class="line"><span class="comment"># Create a new user to our new container and avoid the root user</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> useradd --user-group --create-home --shell /bin/<span class="literal">false</span> nupp &amp;&amp; \</span></div><div class="line">    apt-get clean</div><div class="line"><span class="keyword">ENV</span> HOME=/home/nupp</div><div class="line"><span class="keyword">COPY</span><span class="bash"> package.json npm-shrinkwrap.json <span class="variable">$HOME</span>/app/</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> src/ <span class="variable">$HOME</span>/app/src</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> chown -R nupp:nupp <span class="variable">$HOME</span>/* /usr/<span class="built_in">local</span>/</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$HOME</span>/app</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> npm cache clean &amp;&amp; \</span></div><div class="line">    npm install --silent --progress=<span class="literal">false</span> --production</div><div class="line"><span class="keyword">RUN</span><span class="bash"> chown -R nupp:nupp <span class="variable">$HOME</span>/*</span></div><div class="line"><span class="keyword">USER</span> nupp</div><div class="line"></div><div class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></div><div class="line"></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"npm"</span>, <span class="string">"start"</span>]</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”¨ NodeJS é•œåƒä½œä¸ºæˆ‘ä»¬çš„åŸºç¡€é•œåƒï¼Œç„¶ååˆ›å»ºä¸€ä¸ªç”¨æˆ·é¿å…ä½¿ç”¨ root è´¦æˆ·ï¼Œä¹‹åæˆ‘ä»¬æŠŠæºç æ‹·è´åˆ°é•œåƒä¸­å†å®‰è£…ä¾èµ–åº“ï¼Œå¯¹å¤–æš´éœ²ä¸€ä¸ªç«¯å£å·ï¼Œæœ€åå®ä¾‹åŒ–æˆ‘ä»¬çš„ç”µå½±æœåŠ¡ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ„å»ºæˆ‘ä»¬çš„ docker é•œåƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker build -t moives-service .</div></pre></td></tr></table></figure>
<p>å…ˆåˆ†æä¸€ä¸‹è¿™æ¡æ„å»ºæŒ‡ä»¤ã€‚</p>
<ol>
<li><code>docker build</code> å‘Šè¯‰ docker å¼•æ“æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</li>
<li><code>-t moives-service</code> å°†è¿™ä¸ªé•œåƒæ‰“ä¸Š <code>movies-service</code> æ ‡ç­¾ã€‚ä»¥åæˆ‘ä»¬å°±å¯ä»¥ç”¨æ ‡ç­¾å¼•ç”¨è¿™ä¸ªé•œåƒã€‚</li>
<li><code>.</code> è¡¨ç¤ºåœ¨å½“å‰ç›®å½•å¯»æ‰¾ <code>Dockerfile</code> ã€‚</li>
</ol>
<p>åœ¨çœ‹åˆ°ä¸€äº›å‘½ä»¤è¡Œè¾“å‡ºä¹‹åï¼ŒåŒ…å«æˆ‘ä»¬çš„ NodeJS åº”ç”¨çš„é•œåƒå°±å‡†å¤‡å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œè¿™ä¸ªé•œåƒäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run --name movie-service -p 3000:3000 -e DB_SERVERS=&quot;192.168.99.100:27017 192.168.99.101:27017 192.168.99.100:27017&quot; -d movies-service</div></pre></td></tr></table></figure>
<p>å‘½ä»¤ä¸­æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨æ¥æä¾› mongoDB é›†ç¾¤çš„æœåŠ¡å™¨åœ°å€ï¼Œè¿™å„¿åªæ˜¯åšä¸€ä¸ªæ¼”ç¤ºï¼Œå®é™…å¯ä»¥æœ‰æ›´å¥½æ“ä½œçš„æ–¹å¼ï¼Œæ¯”å¦‚ä» env æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬çš„ docker å®¹å™¨å·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ <code>docker-machine ip machine-name</code> è·å–å¾®æœåŠ¡çš„ ip åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å¾®æœåŠ¡å°±å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œé›†æˆæµ‹è¯•äº†ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ï¼Œå®ƒä¼šè¿›è¡Œä¸€ä¸ªæ¥å£è°ƒç”¨æ£€æµ‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* eslint-env mocha */</span></div><div class="line"><span class="keyword">const</span> supertest = <span class="built_in">require</span>(<span class="string">'supertest'</span>)</div><div class="line"></div><div class="line">describe(<span class="string">'movies-service'</span>, () =&gt; &#123;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> api = supertest(<span class="string">'http://192.168.99.100:3000'</span>)</div><div class="line"></div><div class="line">  it(<span class="string">'returns a 200 for a collection of movies'</span>, (done) =&gt; &#123;</div><div class="line"></div><div class="line">    api.get(<span class="string">'/movies/premiers'</span>)</div><div class="line">      .expect(<span class="number">200</span>, done)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// movies-service-integration.test.js</span></div></pre></td></tr></table></figure>
<h2 id="æ€»ç»“æ—¶é—´"><a href="#æ€»ç»“æ—¶é—´" class="headerlink" title="æ€»ç»“æ—¶é—´"></a>æ€»ç»“æ—¶é—´</h2><p>æœ€åå›é¡¾ä¸€ä¸‹æˆ‘ä»¬éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<p><img src="https://img.zvz.im/imgs/2019/06/f142eea98b22201f.png" alt=""></p>
<p>æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»¥ä¸Šä¿¡æ¯äº¤äº’ä¸­çš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œæ„å»ºäº†<strong>ç”µå½±æœåŠ¡</strong>ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç”µå½±é™¢æŸ¥è¯¢ç”µå½±é¦–æ˜ æ—¶é—´ï¼Œä½¿ç”¨ NodeJS å®ç°äº†<strong>ç”µå½±æœåŠ¡</strong>çš„ APIï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ª <strong>RAML</strong> æ–‡ä»¶è¿›è¡Œ <strong>API è®¾è®¡</strong>ï¼Œç„¶åå¼€å§‹æ„å»ºæˆ‘ä»¬çš„ <strong>API</strong>ï¼Œå¹¶ä¸”è¿›è¡Œäº†ç›¸åº”çš„<strong>å•å…ƒæµ‹è¯•</strong>ï¼Œæœ€åæŠŠæ‰€æœ‰çš„ä»£ç æ•´åˆæˆæˆ‘ä»¬çš„<strong>å¾®æœåŠ¡</strong>ï¼Œä½¿æˆ‘ä»¬çš„ç”µå½±æœåŠ¡å¯ä»¥å¯åŠ¨èµ·æ¥ã€‚</p>
<p>ä¹‹åæˆ‘ä»¬æŠŠæˆ‘ä»¬çš„<strong>å¾®æœåŠ¡</strong>æ‰“åŒ…è¿› <strong>Docker</strong> å®¹å™¨ï¼Œä½¿æˆ‘ä»¬èƒ½å¯¹å…¶è¿›è¡Œä¸€äº›<strong>é›†æˆæµ‹è¯•ã€‚</strong></p>
<p>è™½ç„¶æˆ‘ä»¬å¯èƒ½è§è¿‡è®¸å¤š <strong>NodeJS</strong> å¼€å‘çš„é¡¹ç›®ï¼Œä¸è¿‡ä»ç„¶è¿˜æœ‰è®¸å¤šä¸œè¥¿å€¼å¾—æˆ‘ä»¬å»å­¦ä¹ å’Œå®è·µã€‚æœ¬æ–‡åªæ˜¯ä¸€ä¸ªå°å°çš„å±•ç¤ºï¼Œæˆ‘å¸Œæœ›å®ƒå±•ç¤ºå‡ºäº†ä¸€äº›æœ‰è¶£è€Œæœ‰ç”¨çš„ä¸œè¥¿ï¼Œä½¿ä½ åœ¨å·¥ä½œä¸­èƒ½å¤Ÿè¿ç”¨ <strong>Docker å’Œ NodeJS</strong> çš„ç›¸å…³æŠ€æœ¯ã€‚</p>
<h2 id="Github-ä¸Šçš„å®Œæ•´ä»£ç "><a href="#Github-ä¸Šçš„å®Œæ•´ä»£ç " class="headerlink" title="Github ä¸Šçš„å®Œæ•´ä»£ç "></a>Github ä¸Šçš„å®Œæ•´ä»£ç </h2><p>ä½ å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°æœ¬æ–‡çš„å®Œæ•´ä»£ç  <a href="https://github.com/Crizstian/cinema-microservice" target="_blank" rel="external">Crizstian/cinema-microservice</a>ã€‚</p>
<p>ç¿»è¯‘è‡ªï¼š<a href="https://medium.com/@cramirez92/build-a-nodejs-cinema-microservice-and-deploying-it-with-docker-part-1-7e28e25bfa8b" target="_blank" rel="external">Build a NodeJS cinema microservice and deploying it with dockerâ€Šâ€”â€Špart 1</a></p>
<p><a href="https://log.zvz.im/2017/05/24/nodejs-cinema-microservice-part2/">ç³»åˆ—æ–‡ç«  - Part 2</a></p>

      

      
        
    </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/17/nodejs-cinema-microservice-part2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ç”¨ NodeJS æ‰“é€ å½±é™¢å¾®æœåŠ¡å¹¶éƒ¨ç½²åˆ° docker ä¸Š â€” Part 2
        
      </div>
    </a>
  
  
    <a href="/2017/03/23/why-curry-helps/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ä¸ºä»€ä¹ˆæŸ¯é‡ŒåŒ–æœ‰ç”¨</div>
    </a>
  
</nav>

  
</article>

<script type='text/javascript'>window.notIndexPage = true;</script>


<section id="comments">
  <div id="disqus_thread">
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'imzvz'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>
    Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </div>
</section>
</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>
      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	Linked with:&nbsp;&nbsp;&nbsp; 
	<a href="http://mritd.me" target="_blank">mritd.me</a>&nbsp;&nbsp;&nbsp;
	<a href="https://www.mghio.cn" target="_blank">mghio's blog</a>&nbsp;&nbsp;&nbsp;
	<a href="https://sillydong.com" target="_blank">å‚»ä¸œã®å­¦ä¹ ç¬”è®°</a>&nbsp;&nbsp;&nbsp;
	</div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
</nav>
    
<script>
  var disqus_shortname = 'imzvz';
  
  var disqus_url = 'http://log.zvz.im/2017/05/24/nodejs-cinema-microservice-part1/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>

<script>
  if(window.notIndexPage)
  $(function(){
    $.get('//manage.zvz.im/api/posts/adv', function(res) {
      if(res.data.length) {
        $.each(res.data, function(idx, adv) {
          if(idx == 0) {
            if($('h2:first').length > 0) {
              $(adv).insertBefore('h2:first');
              return;
            }
          }
          $(adv).insertAfter('.article-inner');
        });
      }
    });
  });
</script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/require.min.js"></script>
<script src="/js/script.js"></script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>